services:
  speedtest-tracker:
    image: ${SPEEDTEST_TRACKER_IMAGE}
    restart: unless-stopped
    environment:
      - PUID=${SPEEDTEST_TRACKER_UID}
      - PGID=${SPEEDTEST_TRACKER_GID}
      - APP_KEY=${SPEEDTEST_TRACKER_APP_KEY}
      - DB_CONNECTION=sqlite
      - ADMIN_NAME=${SPEEDTEST_TRACKER_ADMIN_NAME}
      - ADMIN_EMAIL=${SPEEDTEST_TRACKER_ADMIN_EMAIL}
      - ADMIN_PASSWORD=${SPEEDTEST_TRACKER_ADMIN_PASSWORD}
      - DISPLAY_TIMEZONE=${SPEEDTEST_TRACKER_DISPLAY_TIMEZONE}
      - APP_URL=${SPEEDTEST_TRACKER_TRAEFIK_HOST}
      # Unused because setting as described in docs results in failed CSS 
      #- ASSET_URL=${SPEEDTEST_TRACKER_TRAEFIK_HOST}
      - APP_DEBUG=${SPEEDTEST_APP_DEBUG}
      - PUBLIC_DASHBOARD=${SPEEDTEST_PUBLIC_DASHBOARD}
      - SPEEDTEST_SCHEDULE=${SPEEDTEST_SCHEDULE}
      - APP_NAME=${SPEEDTEST_APP_NAME}
      - PRUNE_RESULTS_OLDER_THAN=${SPEEDTEST_PRUNE_RESULTS_OLDER_THAN}
    volumes:
      - data:/config
      - keys:/config/keys
    sysctls:
      - net.ipv4.ip_unprivileged_port_start=1024
    labels: []
    healthcheck:
        test: curl -fSs APP_URL/api/healthcheck | jq -r .message || exit 1
        interval: 10s
        retries: 3
        start_period: 30s
        timeout: 10s
    
volumes:
  data:
  keys: