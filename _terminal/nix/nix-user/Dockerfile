ARG COMMON_BASE_IMAGE
FROM ${COMMON_BASE_IMAGE}

ARG NIX_GIT_USERNAME
ARG NIX_GIT_EMAIL
ARG NIX_GIT_D_RYMCG_TECH_CLONE
ARG NIX_GIT_D_RYMCG_TECH_REPO
ARG NIX_GIT_BRANCH
ARG NIX_DOCKER_SSH_HOST
ARG NIX_DOCKER_SSH_USER
ARG NIX_DOCKER_SSH_PORT
ENV NIX_GIT_USERNAME=${NIX_GIT_USERNAME} \
    NIX_GIT_EMAIL=${NIX_GIT_EMAIL} \
    NIX_GIT_D_RYMCG_TECH_CLONE=${NIX_GIT_D_RYMCG_TECH_CLONE} \
    NIX_GIT_D_RYMCG_TECH_REPO=${NIX_GIT_D_RYMCG_TECH_REPO} \
    NIX_GIT_BRANCH=${NIX_GIT_BRANCH} \
    NIX_DOCKER_SSH_HOST=${NIX_DOCKER_SSH_HOST} \
    NIX_DOCKER_SSH_USER=${NIX_DOCKER_SSH_USER} \
    NIX_DOCKER_SSH_PORT=${NIX_DOCKER_SSH_PORT}

COPY --chown=${NIX_USER_UID}:${NIX_USER_GID} nixpkgs .config/nixpkgs
RUN home-manager build
ENTRYPOINT ["/usr/local/bin/entrypoint"]
VOLUME /home/${NIX_USER_NAME}
