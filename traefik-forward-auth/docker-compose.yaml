version: "3.3"

networks:
  traefik-proxy:
    name: traefik-proxy

services:
  traefik-forward-auth:
    image: thomseddon/traefik-forward-auth:2
    container_name: traefik-forward-auth
    networks:
      - traefik-proxy
    environment:
      - SECRET
      - LOG_LEVEL
      - AUTH_HOST
      - COOKIE_DOMAIN
      - DEFAULT_PROVIDER
      - PROVIDERS_GENERIC_OAUTH_AUTH_URL
      - PROVIDERS_GENERIC_OAUTH_TOKEN_URL
      - PROVIDERS_GENERIC_OAUTH_USER_URL
      - PROVIDERS_GENERIC_OAUTH_CLIENT_ID
      - PROVIDERS_GENERIC_OAUTH_CLIENT_SECRET
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.traefik-forward-auth.loadbalancer.server.port=4181"
      - "traefik.http.middlewares.traefik-forward-auth.forwardAuth.address=http://traefik-forward-auth:4181"
      - "traefik.http.middlewares.traefik-forward-auth.forwardAuth.authResponseHeaders=X-Forwarded-User"

      - "traefik.http.routers.traefik-forward-auth.rule=Host(`${AUTH_HOST}`)"
      - "traefik.http.routers.traefik-forward-auth.entrypoints=websecure"
      - "traefik.http.routers.traefik-forward-auth.tls.certresolver=${ACME_CERT_RESOLVER}"
      - "traefik.http.routers.traefik-forward-auth.middlewares=traefik-forward-auth"

volumes:
  data:
  config:
