version: "3.9"

volumes:
  config:
  data:

services:
  config:
    build:
      context: config
    security_opt:
      - no-new-privileges:true
    environment:
      - ACME_DNS_ADMIN_EMAIL
      - ACME_DNS_PUBLIC_IP
      - ACME_DNS_ENABLE_REGISTRATION
      - ACME_DNS_ACME_CA_EMAIL
    volumes:
      - config:/config

  acme-dns:
    image: ${ACME_DNS_IMAGE}:${ACME_DNS_VERSION}
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    sysctls:
      - net.ipv4.ip_unprivileged_port_start=1024
    volumes:
      - config:/etc/acme-dns:ro
      - data:/var/lib/acme-dns
    # All labels are defined in the template: docker-compose.instance.yaml
    # The labels will merge together here from the template output:
    #   docker-compose.override_{DOCKER_CONTEXT}_{INSTANCE}.yaml
    labels: []
