volumes:
  data:

services:
  minio:
    image: ${MINIO_IMAGE}
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    environment:
      - MINIO_ROOT_USER
      - MINIO_ROOT_PASSWORD
    volumes:
      - data:/data
    command: server /data --console-address ":9001"
    labels: []

  mc:
    profiles: ['tools']
    image: localhost/mc
    build:
      context: mc
      args:
        STEP_CA_ENABLED: ${MINIO_STEP_CA_ENABLED}
        STEP_CA_ENDPOINT: ${MINIO_STEP_CA_ENDPOINT}
        STEP_CA_FINGERPRINT: ${MINIO_STEP_CA_FINGERPRINT}
    # environment:
    #   - CONSOLE_MINIO_SERVER=${MINIO_TRAEFIK_HOST}
    #   - OPENMAXIO_MINIO_USER=${MINIO_ROOT_USER}
    #   - MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}
    #   - CONSOLE_USER_SECRET=duehuedheuhiwehfieufhwiufhwef733
    #   - MINIO_ALIAS=minio_test_set_in_docker-compose
    #   - MINIO_OPENMAXIO_ACCESS_KEY=${MINIO_OPENMAXIO_ACCESS_KEY}
    #   - MINIO_OPENMAXIO_SECRET_KEY=${MINIO_OPENMAXIO_SECRET_KEY}
    labels:
      - "backup-volume.stop-during-backup=true"

  openmaxio:
    profiles: ['openmaxio']
    build:
      context: ./openmaxio
      args:
        OPENMAXIO_VERSION: ${MINIO_OPENMAXIO_VERSION}
    environment:
      - CONSOLE_PBKDF_PASSPHRASE=${MINIO_OPENMAXIO_PASSPHRASE}
      - CONSOLE_PBKDF_SALT=${MINIO_OPENMAXIO_SALT}
      # - S3_ENDPOINT=https://${MINIO_TRAEFIK_HOST}
      # - S3_ACCESS_KEY=${MINIO_OPENMAXIO_ACCESS_KEY}
      # - S3_SECRET_KEY=${MINIO_OPENMAXIO_SECRET_KEY}
      # - CONSOLE_MINIO_SERVER=https://${MINIO_TRAEFIK_HOST}
      # - CONSOLE_MINIO_ACCESS_KEY=${MINIO_OPENMAXIO_ACCESS_KEY}
      # - CONSOLE_MINIO_SECRET_KEY=${MINIO_OPENMAXIO_SECRET_KEY}
      # - CONSOLE_MINIO_SERVER=http://minio:9001
      # - CONSOLE_MINIO_ACCESS_KEY=root
      # - CONSOLE_MINIO_SECRET_KEY=5e314a414b8a029fc75da3e978fd8355cea4e72e278c387fe53f9f979bc8c36e2dbc810d4c754fd25adbbdd39a
      - CONSOLE_MINIO_SERVER=https://s3.thewooskeys.com
      - CONSOLE_MINIO_ACCESS_KEY=root
      - CONSOLE_MINIO_SECRET_KEY=9dbe49ab6058e6ff8e1cac5bb3535533927eaa9b51756e347876f7142d0326497125830823762230da529ed735
      - CONSOLE_DEBUG_LOGLEVEL=6
    restart: unless-stopped
    labels: []
