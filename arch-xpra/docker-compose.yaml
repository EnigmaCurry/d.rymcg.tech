version: "3.9"

volumes:
  sshd_keys:
  user_home:

services:
  arch-xpra:
    build:
      context: arch
      args:
        ARCH_MIRROR: ${ARCH_XPRA_ARCH_MIRROR}
        USERNAME: ${ARCH_XPRA_USERNAME}
        BASE_PACKAGES: ${ARCH_XPRA_BASE_PACKAGES}
        EXTRA_PACKAGES: ${ARCH_XPRA_EXTRA_PACKAGES}
    hostname: ${ARCH_XPRA_HOSTNAME}
    environment:
      - AUTHORIZED_KEY=${ARCH_XPRA_AUTHORIZED_KEY}
    restart: unless-stopped
    ports:
      - ${ARCH_XPRA_SSH_PORT}:22
    volumes:
      - sshd_keys:/etc/ssh/keys
      - user_home:/home/${ARCH_XPRA_USERNAME}
    # All labels are defined in the template: docker-compose.instance.yaml
    # The labels will merge together here from the template output:
    #   docker-compose.override_{DOCKER_CONTEXT}_{INSTANCE}.yaml
    labels: []
