#! See the header file in ../_common/instance_header.yaml

#! Add the standard traefik labels to all your services:
#! This creates the router, and applies the standard HTTP authentication and IP filtering middlewares:
#! basic_traefik_config args takes the NAMES of the environment variables to reference, not the values themselves.
services:
  api: #@ basic_traefik_config(service="api", traefik_host_var="${CREATE_TEMPLATE_PROJECT_NAME_UPPERCASE}_TRAEFIK_HOST", ip_sourcerange_var="${CREATE_TEMPLATE_PROJECT_NAME_UPPERCASE}_IP_SOURCERANGE", http_auth_var="${CREATE_TEMPLATE_PROJECT_NAME_UPPERCASE}_HTTP_AUTH", port=None)
volumes: {}
---
#@overlay/match by=overlay.all, expects=1
---
#! Custom config for Flask:
services:
  #@overlay/match-child-defaults missing_ok=True
  api:
    #@ if development_mode:
    command:
      #! Add the gunicorn live-reload argument:
      - --reload
    volumes:
      #! Overlay the development source code volume onto the container's /code directory:
      #! `make dev-sync` will rsync development files to this volume for the server to reload:
      - development:/code
    #@ end
    labels:
      - "additional custom label - ignore this - example only"

#@overlay/match-child-defaults missing_ok=True
volumes:
  #! Create the volume for `make dev-sync` to rsync files to:
  #@ if development_mode:
  development:
  #@ end
