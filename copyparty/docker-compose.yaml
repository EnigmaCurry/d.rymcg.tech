volumes:
  data:

services:
  copyparty:
    build:
      context: copyparty
      args:
        COPYPARTY_IMAGE: ${COPYPARTY_IMAGE}
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true
    sysctls:
      - net.ipv4.ip_unprivileged_port_start=1024
    restart: unless-stopped
    environment:
      - COPYPARTY_ADMIN_USER
      - COPYPARTY_ADMIN_PASSWORD
      - COPYPARTY_ENABLE_PUBLIC_ACCESS
      - COPYPARTY_ENABLE_GUEST_ACCESS
      - COPYPARTY_USERS
      - COPYPARTY_ENABLE_STATS
      - COPYPARTY_DISABLE_DUPE
      - COPYPARTY_NO_ROBOTS
      - COPYPARTY_FORCE_JS
      - COPYPARTY_DATA_DIR=/data
      - COPYPARTY_VOL_EXTERNAL
      - COPYPARTY_VOL_PERMISSIONS
      - COPYPARTY_VOL_PUBLIC_PATH=/data/public
      - COPYPARTY_VOL_GUESTS_PATH=/data/guests
    volumes:
      - data:/data
    # All labels are defined in the template: docker-compose.instance.yaml
    labels: []

  notifications:
    build:
      context: notifications
    restart: unless-stopped
    user: "10001:10001"
    read_only: true
    security_opt:
      - no-new-privileges:true
    cap_drop: [ "ALL" ]
    environment:
      - COPYPARTY_NOTIFICATIONS_METHOD
      - COPYPARTY_NOTIFICATIONS_WEBHOOK_URL
      - COPYPARTY_NOTIFICATIONS_WEBHOOK_USERNAME
      - COPYPARTY_NOTIFICATIONS_WEBHOOK_PASSWORD
      - COPYPARTY_NOTIFICATIONS_WEBHOOK_TOKEN
      - COPYPARTY_NOTIFICATIONS_NTFY_URL
      - COPYPARTY_NOTIFICATIONS_NTFY_USERNAME
      - COPYPARTY_NOTIFICATIONS_NTFY_PASSWORD
      - COPYPARTY_NOTIFICATIONS_NTFY_TOKEN
      - COPYPARTY_NOTIFICATIONS_MONITOR_VOLUMES
      - COPYPARTY_NOTIFICATIONS_MONITOR_DEBOUNCE_SECONDS
    volumes:
      - data:/data
